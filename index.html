<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niilo - Entendimiento Operativo v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: slideIn 0.3s ease-out; }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.expanded { max-height: 3000px; }
        .progress-bar { transition: width 0.5s ease-out; }
        input[type="radio"]:checked + label {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    
    <!-- Header fijo -->
    <header class="bg-white shadow-sm sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Niilo - Entendimiento Operativo</h1>
                    <p class="text-sm text-gray-600">Validaci√≥n + Decisiones para T&C Nuevos v3.0</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="guardarProgreso()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        üíæ Guardar
                    </button>
                    <button onclick="exportarPDF()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        üìÑ Exportar PDF
                    </button>
                </div>
            </div>
            
            <!-- Progress bar -->
            <div class="mt-4">
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600">Progreso General</span>
                    <span class="font-medium text-blue-600" id="progress-text">0% (0/10)</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progress-bar" class="progress-bar bg-blue-600 h-3 rounded-full" style="width: 0%"></div>
                </div>
                <div class="flex gap-2 mt-2 text-xs">
                    <span class="text-green-600">‚úÖ <span id="completados">0</span> Completados</span>
                    <span class="text-yellow-600">‚è≥ <span id="enprogreso">0</span> En progreso</span>
                    <span class="text-gray-500">üìù <span id="pendientes">10</span> Pendientes</span>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-8 flex gap-6">
        
        <!-- Sidebar - √çndice -->
        <aside class="w-80 flex-shrink-0 no-print">
            <div class="bg-white rounded-lg shadow-lg p-6 sticky top-24">
                <h2 class="text-lg font-bold mb-4">üìë √çndice Interactivo</h2>
                
                <nav id="navigation" class="space-y-1">
                    <!-- Gateway -->
                    <div class="mb-4">
                        <div class="text-xs font-semibold text-gray-500 mb-2 uppercase">‚≠ê Gateway</div>
                        <button onclick="navegarModulo('m0')" id="nav-m0" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>‚≠ê M0: Validaci√≥n R√°pida</span>
                                <span class="text-xs text-gray-500">2m</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Diagn√≥stico -->
                    <div class="mb-4">
                        <div class="text-xs font-semibold text-gray-500 mb-2 uppercase">‚ÑπÔ∏è Diagn√≥stico</div>
                        <button onclick="navegarModulo('m1')" id="nav-m1" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>üìÑ M1: Hallazgos T&C</span>
                                <span class="text-xs text-gray-500">5m</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Cr√≠tico -->
                    <div class="mb-4">
                        <div class="text-xs font-semibold text-red-600 mb-2 uppercase">üî¥ Cr√≠tico</div>
                        <button onclick="navegarModulo('m2')" id="nav-m2" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>üì£ M2: Claims Marketing</span>
                                <span class="text-xs text-gray-500">10m</span>
                            </div>
                        </button>
                        <button onclick="navegarModulo('m3')" id="nav-m3" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>üéì M3: Classrooms</span>
                                <span class="text-xs text-gray-500">5m</span>
                            </div>
                        </button>
                        <button onclick="navegarModulo('m4')" id="nav-m4" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>üîí M4: Data Rooms</span>
                                <span class="text-xs text-gray-500">5m</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Importante -->
                    <div class="mb-4">
                        <div class="text-xs font-semibold text-yellow-600 mb-2 uppercase">üü° Importante</div>
                        <button onclick="navegarModulo('m5')" id="nav-m5" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>üíº M5: Investor Match</span>
                                <span class="text-xs text-gray-500">5m</span>
                            </div>
                        </button>
                        <button onclick="navegarModulo('m6')" id="nav-m6" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>‚öñÔ∏è M6: Limitaci√≥n Resp</span>
                                <span class="text-xs text-gray-500">3m</span>
                            </div>
                        </button>
                        <button onclick="navegarModulo('m7')" id="nav-m7" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>üéØ M7: Elegibilidad</span>
                                <span class="text-xs text-gray-500">2m</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Deseable -->
                    <div class="mb-4">
                        <div class="text-xs font-semibold text-green-600 mb-2 uppercase">üü¢ Deseable</div>
                        <button onclick="navegarModulo('m8')" id="nav-m8" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>‚öôÔ∏è M8: Confirmaciones</span>
                                <span class="text-xs text-gray-500">15m</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Evaluaci√≥n -->
                    <div class="mb-4">
                        <div class="text-xs font-semibold text-purple-600 mb-2 uppercase">üìä Evaluaci√≥n</div>
                        <button onclick="navegarModulo('m9')" id="nav-m9" class="w-full text-left px-3 py-2 rounded-lg text-sm transition mb-1 hover:bg-gray-100">
                            <div class="flex items-center justify-between">
                                <span>üìà M9: Antes/Despu√©s</span>
                                <span class="text-xs text-gray-500">5m</span>
                            </div>
                        </button>
                    </div>
                </nav>
                
                <div class="mt-6 pt-6 border-t">
                    <div class="text-xs text-gray-500">üíæ Guardado autom√°tico cada 30s</div>
                    <div class="text-xs text-gray-500 mt-1">‚è±Ô∏è Tiempo total: 47 min</div>
                </div>
            </div>
        </aside>

        <!-- Main content -->
        <main class="flex-1">
            <div id="modulos-container"></div>
        </main>
    </div>

    <!-- Modal para alertas -->
    <div id="alert-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-2xl w-full p-6 fade-in">
            <div class="flex items-start gap-4">
                <div id="alert-icon" class="text-4xl flex-shrink-0"></div>
                <div class="flex-1">
                    <h3 id="alert-title" class="text-xl font-bold mb-2"></h3>
                    <div id="alert-message" class="text-gray-700 mb-4"></div>
                    <div id="alert-actions" class="flex gap-3 justify-end"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
// === DATOS ===
const MODULOS_DATA = {
    m0: {
        id: 'm0',
        titulo: 'Validaci√≥n R√°pida Entendimiento',
        icono: '‚≠ê',
        badge: 'GATEWAY',
        tipo: 'preguntas',
        html: `
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <p class="text-sm text-yellow-800">
                    <strong>Importante:</strong> Si algo NO est√° correcto, el sistema te pedir√° pausar y agendar llamada de 15 min antes de continuar.
                </p>
            </div>
            
            <div class="space-y-8">
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">1Ô∏è‚É£ MODELO DE NEGOCIO</h3>
                    <p class="text-gray-700 mb-4">Entendimos que Niilo opera un modelo <strong>H√çBRIDO</strong>: SaaS (55%), Marketplace EdTech (25%), Portal Comunidad (10%), Data Provider (10%)</p>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m0_p1" value="si" onchange="handleRespuesta('m0_p1', 'si')" class="mt-1 mr-3">
                            <span>‚úÖ S√ç, correcto - Continuar</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m0_p1" value="no" onchange="handleRespuesta('m0_p1', 'no')" class="mt-1 mr-3">
                            <span>‚ùå NO, correcci√≥n necesaria</span>
                        </label>
                    </div>
                    <div id="cond_m0_p1" class="mt-4"></div>
                </div>
                
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">2Ô∏è‚É£ NATURALEZA DE USUARIOS</h3>
                    <p class="text-gray-700 mb-4">Entendimos que tus usuarios principales son <strong>EMPRENDEDORES</strong> que usan Niilo como HERRAMIENTA para su negocio (NO consumidores Ley 1480)</p>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m0_p2" value="si" onchange="handleRespuesta('m0_p2', 'si')" class="mt-1 mr-3">
                            <span>‚úÖ S√ç, correcto - 99%+ son emprendedores</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m0_p2" value="no" onchange="handleRespuesta('m0_p2', 'no')" class="mt-1 mr-3">
                            <span>‚ùå NO, hay usuarios significativos sin intenci√≥n empresarial</span>
                        </label>
                    </div>
                    <div id="cond_m0_p2" class="mt-4"></div>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold mb-3">3Ô∏è‚É£ SERVICIOS OPERATIVOS ACTUALES</h3>
                    <p class="text-gray-700 mb-4">Entendimos que operan: AI Copilot, Data Rooms, Investor Matching, Deck/Sales Review, Classrooms, E-learning, Comunidad/Wall/Blogs, Biblioteca</p>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m0_p3" value="si" onchange="handleRespuesta('m0_p3', 'si')" class="mt-1 mr-3">
                            <span>‚úÖ S√ç, esos son todos los servicios activos</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m0_p3" value="no" onchange="handleRespuesta('m0_p3', 'no')" class="mt-1 mr-3">
                            <span>‚ùå NO, hay diferencias</span>
                        </label>
                    </div>
                    <div id="cond_m0_p3" class="mt-4"></div>
                </div>
            </div>
        `
    },
    
    m1: {
        id: 'm1',
        titulo: 'Hallazgos en T&C Actuales',
        icono: 'üìÑ',
        badge: 'DIAGN√ìSTICO',
        tipo: 'lectura',
        html: `
            <div class="bg-gray-50 rounded-lg p-6 mb-6">
                <h3 class="text-xl font-bold mb-4">üìä Resumen Ejecutivo</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <div class="text-sm text-gray-600 mb-1">Calidad Legal:</div>
                        <div class="text-3xl font-bold text-red-600">üî¥ DEFICIENTE</div>
                        <div class="text-sm text-gray-500">Score: 35/100</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600 mb-2">Problemas Detectados:</div>
                        <div class="space-y-1 text-sm">
                            <div>üî¥ Cr√≠ticos: 5</div>
                            <div>üü° Importantes: 10</div>
                            <div>üü¢ Menores: 5</div>
                            <div>‚úÖ Secciones buenas: 6</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h3 class="text-xl font-bold mb-4">üî¥ Top 5 Problemas Cr√≠ticos</h3>
            <div class="space-y-4">
                <div class="border rounded-lg overflow-hidden">
                    <button onclick="toggleCollapsible('rf1')" class="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 transition text-left flex justify-between items-center">
                        <div>
                            <span class="font-semibold">#1: Limitaci√≥n Responsabilidad NULA</span>
                            <span class="ml-2 text-sm text-gray-500">Resuelve: M6</span>
                        </div>
                        <span id="icon_rf1">‚ñº</span>
                    </button>
                    <div id="rf1" class="collapsible-content">
                        <div class="p-4 bg-white border-t">
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üìç Ubicaci√≥n:</div>
                                <div class="font-medium">Secci√≥n X de T&C actuales</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">‚ùå Problema:</div>
                                <div class="text-gray-800">Cl√°usula intenta exonerar TODO tipo de responsabilidad, incluyendo dolo y culpa grave. Viola Art. 1522 CC.</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üí• Consecuencia:</div>
                                <div class="text-gray-800">
                                    ‚ùå Juez eliminar√° autom√°ticamente<br>
                                    ‚ùå Niilo queda SIN protecci√≥n<br>
                                    ‚ùå Exposici√≥n: Responsabilidad ilimitada
                                </div>
                            </div>
                            <div class="bg-green-50 p-3 rounded">
                                <div class="text-sm font-semibold text-green-800 mb-1">‚úÖ Soluci√≥n:</div>
                                <div class="text-green-900">M√ìDULO 6 te preguntar√° c√≥mo reescribir con limitaci√≥n RAZONABLE que S√ç sea v√°lida</div>
                            </div>
                            <div class="mt-3">
                                <button onclick="navegarModulo('m6')" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    Ir a M6 ahora ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border rounded-lg overflow-hidden">
                    <button onclick="toggleCollapsible('rf2')" class="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 transition text-left flex justify-between items-center">
                        <div>
                            <span class="font-semibold">#2: Data Rooms Sin Marco Contractual</span>
                            <span class="ml-2 text-sm text-gray-500">Resuelve: M4</span>
                        </div>
                        <span id="icon_rf2">‚ñº</span>
                    </button>
                    <div id="rf2" class="collapsible-content">
                        <div class="p-4 bg-white border-t">
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üìç Ubicaci√≥n:</div>
                                <div class="font-medium">‚ùå AUSENTE (no existe secci√≥n)</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">‚ùå Problema:</div>
                                <div class="text-gray-800">Servicio core sin cl√°usulas de confidencialidad, responsabilidad por filtraci√≥n, pol√≠tica retenci√≥n.</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üí• Consecuencia:</div>
                                <div class="text-gray-800">
                                    ‚ùå Usuario puede alegar "garantizaron seguridad"<br>
                                    ‚ùå Sin disclaimers sobre backups<br>
                                    ‚ùå Exposici√≥n total por datos sensibles
                                </div>
                            </div>
                            <div class="bg-green-50 p-3 rounded">
                                <div class="text-sm font-semibold text-green-800 mb-1">‚úÖ Soluci√≥n:</div>
                                <div class="text-green-900">M√ìDULO 4 generar√° Secci√≥n XIX.7 "Data Rooms" completa</div>
                            </div>
                            <div class="mt-3">
                                <button onclick="navegarModulo('m4')" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    Ir a M4 ahora ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border rounded-lg overflow-hidden">
                    <button onclick="toggleCollapsible('rf3')" class="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 transition text-left flex justify-between items-center">
                        <div>
                            <span class="font-semibold">#3: Sin Cl√°usula Elegibilidad Empresarial</span>
                            <span class="ml-2 text-sm text-gray-500">Resuelve: M7</span>
                        </div>
                        <span id="icon_rf3">‚ñº</span>
                    </button>
                    <div id="rf3" class="collapsible-content">
                        <div class="p-4 bg-white border-t">
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üìç Ubicaci√≥n:</div>
                                <div class="font-medium">‚ùå AUSENTE</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">‚ùå Problema:</div>
                                <div class="text-gray-800">No establece uso exclusivo emprendedores. Debilita argumento NO consumidores Ley 1480.</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üí• Consecuencia:</div>
                                <div class="text-gray-800">
                                    ‚ö†Ô∏è Usuario puede alegar uso personal/familiar<br>
                                    ‚ö†Ô∏è Mayor riesgo aplicaci√≥n Ley 1480 (protecci√≥n consumidor)
                                </div>
                            </div>
                            <div class="bg-green-50 p-3 rounded">
                                <div class="text-sm font-semibold text-green-800 mb-1">‚úÖ Soluci√≥n:</div>
                                <div class="text-green-900">M√ìDULO 7 te preguntar√° si incluir cl√°usula de Elegibilidad Empresarial</div>
                            </div>
                            <div class="mt-3">
                                <button onclick="navegarModulo('m7')" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    Ir a M7 ahora ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border rounded-lg overflow-hidden">
                    <button onclick="toggleCollapsible('rf4')" class="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 transition text-left flex justify-between items-center">
                        <div>
                            <span class="font-semibold">#4: Classrooms Sin T√©rminos Creadores</span>
                            <span class="ml-2 text-sm text-gray-500">Resuelve: M3</span>
                        </div>
                        <span id="icon_rf4">‚ñº</span>
                    </button>
                    <div id="rf4" class="collapsible-content">
                        <div class="p-4 bg-white border-t">
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üìç Ubicaci√≥n:</div>
                                <div class="font-medium">‚ùå No existe documento separado</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">‚ùå Problema:</div>
                                <div class="text-gray-800">Creadores terceros sin contrato. No pueden exigir calidad, cobrar comisi√≥n, definir IP ownership.</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üí• Consecuencia:</div>
                                <div class="text-gray-800">
                                    ‚ùå Disputa con creador sin base legal para defender posici√≥n Niilo<br>
                                    ‚ùå Revenue share no documentado (no exigible)<br>
                                    ‚ùå No pueden retirar Classrooms problem√°ticos legalmente
                                </div>
                            </div>
                            <div class="bg-green-50 p-3 rounded">
                                <div class="text-sm font-semibold text-green-800 mb-1">‚úÖ Soluci√≥n:</div>
                                <div class="text-green-900">M√ìDULO 3 crear√° T√©rminos para Creadores de Classrooms completo</div>
                            </div>
                            <div class="mt-3">
                                <button onclick="navegarModulo('m3')" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    Ir a M3 ahora ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border rounded-lg overflow-hidden">
                    <button onclick="toggleCollapsible('rf5')" class="w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 transition text-left flex justify-between items-center">
                        <div>
                            <span class="font-semibold">#5: Servicios Faltantes en Definiciones</span>
                            <span class="ml-2 text-sm text-gray-500">Resuelve: M2</span>
                        </div>
                        <span id="icon_rf5">‚ñº</span>
                    </button>
                    <div id="rf5" class="collapsible-content">
                        <div class="p-4 bg-white border-t">
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üìç Ubicaci√≥n:</div>
                                <div class="font-medium">Secci√≥n II (Definiciones)</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">‚ùå Problema:</div>
                                <div class="text-gray-800">Definici√≥n "Servicios" NO incluye: Data Rooms, Investor Matching, Deck/Sales Review Tools, WhatsApp Bot.</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm text-gray-600 mb-1">üí• Consecuencia:</div>
                                <div class="text-gray-800">
                                    ‚ö†Ô∏è Servicios core operando sin cobertura contractual expl√≠cita<br>
                                    ‚ö†Ô∏è Pueden alegar que servicio no est√° cubierto por T&C
                                </div>
                            </div>
                            <div class="bg-green-50 p-3 rounded">
                                <div class="text-sm font-semibold text-green-800 mb-1">‚úÖ Soluci√≥n:</div>
                                <div class="text-green-900">M√ìDULO 2 validar√° claims de todos los servicios y actualizar√° definiciones</div>
                            </div>
                            <div class="mt-3">
                                <button onclick="navegarModulo('m2')" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    Ir a M2 ahora ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-8">
                <button onclick="navegarModulo('m2')" class="px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 transition">
                    ‚úì ENTENDIDO - CONTINUAR CON DECISIONES (M2) ‚Üí
                </button>
            </div>
        `
    },
    
    m2: {
        id: 'm2',
        titulo: 'Claims Marketing vs Realidad',
        icono: 'üì£',
        badge: 'CR√çTICO',
        tipo: 'preguntas',
        html: `
            <div class="space-y-8">
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">CLAIM #1: "AI Copilot personalizado 24/7"</h3>
                    <button onclick="toggleCollapsible('why_m2_c1')" class="text-sm text-blue-600 hover:text-blue-800 font-medium mb-3">
                        üí° Por qu√© importa <span id="icon_why_m2_c1">‚ñº</span>
                    </button>
                    <div id="why_m2_c1" class="collapsible-content mb-4">
                        <div class="p-3 bg-blue-50 rounded text-sm text-gray-700">
                            Prometer "24/7" crea obligaci√≥n legal de disponibilidad continua. Si servicio cae y usuario pierde oportunidad cr√≠tica, puede alegar incumplimiento contractual.
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim1" value="literal" onchange="handleRespuesta('m2_claim1', 'literal')" class="mt-1 mr-3">
                            <span>‚úÖ LITERAL - Garantizamos 99.9% uptime, infraestructura propia</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim1" value="parcial" onchange="handleRespuesta('m2_claim1', 'parcial')" class="mt-1 mr-3">
                            <span>‚≠ê üü° PARCIAL - Generalmente 24/7 pero depende WhatsApp API Meta</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim1" value="marketing" onchange="handleRespuesta('m2_claim1', 'marketing')" class="mt-1 mr-3">
                            <span>‚ùå MARKETING - Es aspiracional, hay interrupciones</span>
                        </label>
                    </div>
                </div>
                
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">CLAIM #2: "Data Rooms custodia documentos sensibles"</h3>
                    <button onclick="toggleCollapsible('why_m2_c2')" class="text-sm text-blue-600 hover:text-blue-800 font-medium mb-3">
                        üí° Por qu√© importa <span id="icon_why_m2_c2">‚ñº</span>
                    </button>
                    <div id="why_m2_c2" class="collapsible-content mb-4">
                        <div class="p-3 bg-blue-50 rounded text-sm text-gray-700">
                            Usar palabra "custodia" implica deber de cuidado especial. Si hay filtraci√≥n sin controles robustos, pueden alegar negligencia grave.
                        </div>
                    </div>
                    <label class="block text-sm font-medium mb-2">¬øCu√°ntos controles de seguridad tienen implementados? (0-11)</label>
                    <input type="number" id="m2_claim2_controles" min="0" max="11" 
                           class="w-full p-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                           onchange="handleRespuesta('m2_claim2_controles', this.value)">
                    <div id="cond_m2_c2" class="mt-4"></div>
                </div>
                
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">CLAIM #3: "Conectamos con inversores verificados" ‚ö†Ô∏è M√ÅS CR√çTICO</h3>
                    <button onclick="toggleCollapsible('why_m2_c3')" class="text-sm text-blue-600 hover:text-blue-800 font-medium mb-3">
                        üí° Por qu√© importa <span id="icon_why_m2_c3">‚ñº</span>
                    </button>
                    <div id="why_m2_c3" class="collapsible-content mb-4">
                        <div class="p-3 bg-blue-50 rounded text-sm text-gray-700">
                            Palabra "VERIFICADOS" crea obligaci√≥n legal de KYC. Si inversor resulta fraudulento, startup puede demandar a Niilo por no verificar.
                        </div>
                    </div>
                    <div class="space-y-2 mb-4">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim3_verif" value="verificamos" onchange="handleRespuesta('m2_claim3_verif', 'verificamos')" class="mt-1 mr-3">
                            <span>‚úÖ VERIFICAMOS - KYC completo: identidad, track record, referencias</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim3_verif" value="curamos" onchange="handleRespuesta('m2_claim3_verif', 'curamos')" class="mt-1 mr-3">
                            <span>‚≠ê üü° CURAMOS - Revisamos LinkedIn, filtramos red flags obvios</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim3_verif" value="no" onchange="handleRespuesta('m2_claim3_verif', 'no')" class="mt-1 mr-3">
                            <span>‚ùå NO VERIFICAMOS - Autodeclaraci√≥n, honor system</span>
                        </label>
                    </div>
                    
                    <h4 class="font-semibold mb-2">¬øNiilo cobra comisi√≥n por matches exitosos?</h4>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim3_comision" value="si" onchange="handleRespuesta('m2_claim3_comision', 'si')" class="mt-1 mr-3">
                            <span>S√ç - Cobramos comisi√≥n (% o fee fijo)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m2_claim3_comision" value="no" onchange="handleRespuesta('m2_claim3_comision', 'no')" class="mt-1 mr-3">
                            <span>‚≠ê NO - Servicio incluido gratis en membres√≠a</span>
                        </label>
                    </div>
                    <div id="cond_m2_c3" class="mt-4"></div>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold mb-3">CLAIM #4: Otros Claims del Website</h3>
                    <p class="text-gray-600 mb-3">Por brevedad, validaci√≥n de claims restantes (Expertos, Biblioteca, Testimonios, Acompa√±amiento) se simplifica.</p>
                    <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                        <input type="checkbox" id="m2_resto_ok" onchange="handleRespuesta('m2_resto_ok', this.checked)" class="mt-1 mr-3">
                        <span>‚úÖ Confirmo que website NO hace promesas incumplibles en otros servicios</span>
                    </label>
                </div>
            </div>
        `
    },
    
    m3: {
        id: 'm3',
        titulo: 'T√©rminos Creadores Classrooms',
        icono: 'üéì',
        badge: 'CR√çTICO',
        tipo: 'preguntas',
        html: `
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <p class="text-sm text-yellow-800">
                    <strong>Contexto:</strong> Sin contrato con creadores, Niilo NO puede exigir calidad, cobrar comisi√≥n, ni retirar Classrooms problem√°ticos legalmente.
                </p>
            </div>
            
            <div class="space-y-8">
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">S3.1 - Revenue Share üí∞</h3>
                    <button onclick="toggleCollapsible('bench_m3_1')" class="text-sm text-purple-600 hover:text-purple-800 font-medium mb-3">
                        üìä Benchmark industria <span id="icon_bench_m3_1">‚ñº</span>
                    </button>
                    <div id="bench_m3_1" class="collapsible-content mb-4">
                        <div class="p-3 bg-purple-50 rounded text-sm text-gray-700">
                            Udemy: 37/63, Teachable: 10/90, Hotmart: 25-30/70-75, Promedio: 30/70
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_revenue" value="70/30" onchange="handleRespuesta('m3_revenue', '70/30')" class="mt-1 mr-3">
                            <span>‚≠ê 70/30 (Creador 70% / Niilo 30%)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_revenue" value="80/20" onchange="handleRespuesta('m3_revenue', '80/20')" class="mt-1 mr-3">
                            <span>80/20 (Creador 80% / Niilo 20%)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_revenue" value="60/40" onchange="handleRespuesta('m3_revenue', '60/40')" class="mt-1 mr-3">
                            <span>60/40 (Creador 60% / Niilo 40%)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_revenue" value="tbd" onchange="handleRespuesta('m3_revenue', 'tbd')" class="mt-1 mr-3">
                            <span>üîÆ TBD - Funcionalidad futura, dejar sin regular</span>
                        </label>
                    </div>
                </div>
                
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">S3.2 - ¬øQui√©n Fija Precio del Classroom?</h3>
                    <button onclick="toggleCollapsible('why_m3_2')" class="text-sm text-blue-600 hover:text-blue-800 font-medium mb-3">
                        üí° Por qu√© importa <span id="icon_why_m3_2">‚ñº</span>
                    </button>
                    <div id="why_m3_2" class="collapsible-content mb-4">
                        <div class="p-3 bg-blue-50 rounded text-sm text-gray-700">
                            Si Niilo fija precio = mayor control sobre transacci√≥n = mayor riesgo de ser tratado como co-proveedor con responsabilidad solidaria (Sentencia SIC 16593/2019).
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_precio" value="creador" onchange="handleRespuesta('m3_precio', 'creador')" class="mt-1 mr-3">
                            <span>‚≠ê CREADOR decide 100% libremente (menor responsabilidad Niilo)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_precio" value="niilo_aprueba" onchange="handleRespuesta('m3_precio', 'niilo_aprueba')" class="mt-1 mr-3">
                            <span>CREADOR propone, Niilo aprueba si razonable</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_precio" value="niilo_fija" onchange="handleRespuesta('m3_precio', 'niilo_fija')" class="mt-1 mr-3">
                            <span>NIILO fija precios finales (‚ö†Ô∏è aumenta responsabilidad)</span>
                        </label>
                    </div>
                </div>
                
                <div class="pb-8 border-b">
                    <h3 class="text-lg font-bold mb-3">S3.3 - ¬øProceso Formal de Aprobaci√≥n?</h3>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_aprobacion" value="si" onchange="handleRespuesta('m3_aprobacion', 'si')" class="mt-1 mr-3">
                            <span>S√ç - Proceso formal de curaci√≥n (revisamos CV, calidad, etc)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_aprobacion" value="no" onchange="handleRespuesta('m3_aprobacion', 'no')" class="mt-1 mr-3">
                            <span>NO - Cualquier creador puede publicar (‚ö†Ô∏è mayor riesgo contenido problem√°tico)</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold mb-3">S3.4 - Propiedad Intelectual üìù</h3>
                    <div class="space-y-2">
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_ip" value="licencia_no_exclusiva" onchange="handleRespuesta('m3_ip', 'licencia_no_exclusiva')" class="mt-1 mr-3">
                            <span>‚≠ê Licencia NO EXCLUSIVA a Niilo (creador puede vender en otras plataformas)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_ip" value="licencia_exclusiva" onchange="handleRespuesta('m3_ip', 'licencia_exclusiva')" class="mt-1 mr-3">
                            <span>Licencia EXCLUSIVA a Niilo (creador NO puede vender en Udemy/Platzi)</span>
                        </label>
                        <label class="flex items-start p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                            <input type="radio" name="m3_ip" value="cesion_total" onchange="handleRespuesta('m3_ip', 'cesion_total')" class="mt-1 mr-3">
                            <span>Niilo adquiere 100% IP (‚ö†Ô∏è muy poco atractivo para creadores)</span>
                        </label>
                    </div>
                </div>
            </div>
        `
    },
    
    m9: {
        id: 'm9',
        titulo: 'Evaluaci√≥n Actualizada',
        icono: 'üìä',
        badge: 'EVALUACI√ìN',
        tipo: 'lectura',
        html: `
            <div class="bg-gradient-to-r from-red-50 to-green-50 p-6 rounded-lg mb-6">
                <h3 class="text-2xl font-bold mb-4">üìä Transformaci√≥n: ANTES vs DESPU√âS</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-2 text-red-800">ANTES (T&C Actuales)</h4>
                        <div class="text-4xl font-bold text-red-600 mb-2">üî¥ DEFICIENTE</div>
                        <div class="text-sm text-gray-600">Score: 35/100</div>
                        <div class="mt-3 text-sm">
                            <div>üî¥ Problemas cr√≠ticos: 5</div>
                            <div>üü° Problemas importantes: 10</div>
                            <div>üü¢ Problemas menores: 5</div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2 text-green-800">DESPU√âS (Con Tus Respuestas)</h4>
                        <div class="text-4xl font-bold text-green-600 mb-2">üü¢ S√ìLIDO</div>
                        <div class="text-sm text-gray-600">Score: 85/100 (+50 pts)</div>
                        <div class="mt-3 text-sm">
                            <div>‚úÖ Resueltos: 15/20 (75%)</div>
                            <div>üîÆ Pendientes TBD: 5</div>
                            <div>üìà Mejora: +50 puntos</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-green-50 p-6 rounded-lg mb-6">
                <h3 class="text-xl font-bold mb-4">‚úÖ Problemas Resueltos con Tus Respuestas</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex items-start">
                        <span class="mr-2">‚úÖ</span>
                        <div>
                            <strong>Limitaci√≥n Responsabilidad:</strong> NULA (violaba Art 1522) ‚Üí Cap 12 meses v√°lido + excepci√≥n dolo/culpa grave
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">‚úÖ</span>
                        <div>
                            <strong>Data Rooms:</strong> AUSENTE ‚Üí Secci√≥n completa agregada con nivel seguridad documentado
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">‚úÖ</span>
                        <div>
                            <strong>Elegibilidad Empresarial:</strong> AUSENTE ‚Üí Cl√°usula incluida (protege argumento NO consumidores)
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">‚úÖ</span>
                        <div>
                            <strong>Classrooms:</strong> Sin contrato creadores ‚Üí T√©rminos completos con revenue share 70/30 definido
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">‚úÖ</span>
                        <div>
                            <strong>Investor Matching:</strong> Riesgo SFC ‚Üí Mitigado (no cobramos comisi√≥n)
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">‚úÖ</span>
                        <div>
                            <strong>Claims Marketing:</strong> 6/8 alineados correctamente con disclaimers apropiados
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-blue-50 p-6 rounded-lg mb-6">
                <h3 class="text-xl font-bold mb-4">üîÆ Pendientes Definir (5 TBD)</h3>
                <p class="text-sm text-gray-700 mb-3">
                    Estos no bloquean redacci√≥n. T&C usar√° lenguaje flexible que permite definir despu√©s sin reescribir todo.
                </p>
                <div class="space-y-2 text-sm">
                    <div>‚Ä¢ Banner renovaci√≥n autom√°tica (M8)</div>
                    <div>‚Ä¢ Pol√≠tica reembolsos espec√≠fica (M8)</div>
                    <div>‚Ä¢ L√≠mites tama√±o Data Rooms (M4)</div>
                    <div>‚Ä¢ Frecuencia pago creadores (M3)</div>
                    <div>‚Ä¢ SLA disponibilidad (M8)</div>
                </div>
            </div>
            
            <div class="bg-purple-50 p-6 rounded-lg mb-6">
                <h3 class="text-xl font-bold mb-4">üìã Pr√≥ximos Pasos</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex items-start">
                        <span class="mr-2">1Ô∏è‚É£</span>
                        <div><strong>FASE 3:</strong> Benchmark competencia (2-3 d√≠as) - Revisar T&C de 5-8 competidores</div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">2Ô∏è‚É£</span>
                        <div><strong>FASE 4:</strong> Levantamiento riesgos (2-3 d√≠as) - An√°lisis 7 Capas completo</div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">3Ô∏è‚É£</span>
                        <div><strong>FASE 5:</strong> Redacci√≥n T&C (3-5 d√≠as) - Documentos completos listos</div>
                    </div>
                    <div class="flex items-start">
                        <span class="mr-2">4Ô∏è‚É£</span>
                        <div><strong>FASE 6:</strong> Post-Mortem (1 d√≠a) - Lecciones aprendidas</div>
                    </div>
                </div>
                <div class="mt-4 text-sm font-semibold">
                    Timeline total: 7-11 d√≠as h√°biles
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="exportarPDF()" class="px-8 py-4 bg-green-600 text-white text-lg font-semibold rounded-lg hover:bg-green-700 transition mr-3">
                    üìÑ Descargar Reporte PDF
                </button>
                <button onclick="navegarModulo('dashboard')" class="px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 transition">
                    üè† Volver al Inicio
                </button>
            </div>
        `
    }
};

// Simplificamos M4-M8 con HTML b√°sico similar
MODULOS_DATA.m4 = {
    id: 'm4', titulo: 'Data Rooms & Seguridad', icono: 'üîí', badge: 'CR√çTICO', tipo: 'preguntas',
    html: '<div class="text-center p-8"><h3 class="text-2xl mb-4">üîí M√≥dulo 4: Data Rooms & Seguridad</h3><p class="text-gray-600 mb-6">Preguntas sobre controles de seguridad, retenci√≥n y compartir.</p><p class="text-sm text-gray-500">Demo: M√≥dulo simplificado. Versi√≥n completa incluir√≠a 3-5 preguntas detalladas.</p></div>'
};
MODULOS_DATA.m5 = {
    id: 'm5', titulo: 'Investor Matching & SFC', icono: 'üíº', badge: 'IMPORTANTE', tipo: 'preguntas',
    html: '<div class="text-center p-8"><h3 class="text-2xl mb-4">üíº M√≥dulo 5: Investor Matching</h3><p class="text-gray-600 mb-6">Flujo operativo, participaci√≥n en negociaci√≥n, NDA.</p><p class="text-sm text-gray-500">Demo: M√≥dulo simplificado. Versi√≥n completa incluir√≠a 3-5 preguntas detalladas.</p></div>'
};
MODULOS_DATA.m6 = {
    id: 'm6', titulo: 'Limitaci√≥n Responsabilidad', icono: '‚öñÔ∏è', badge: 'IMPORTANTE', tipo: 'preguntas',
    html: '<div class="text-center p-8"><h3 class="text-2xl mb-4">‚öñÔ∏è M√≥dulo 6: Limitaci√≥n Responsabilidad</h3><p class="text-gray-600 mb-6">Cap monetario, freemium, da√±os indirectos, seguro E&O.</p><p class="text-sm text-gray-500">Demo: M√≥dulo simplificado. Versi√≥n completa incluir√≠a 4 preguntas detalladas.</p></div>'
};
MODULOS_DATA.m7 = {
    id: 'm7', titulo: 'Elegibilidad Empresarial', icono: 'üéØ', badge: 'IMPORTANTE', tipo: 'preguntas',
    html: '<div class="text-center p-8"><h3 class="text-2xl mb-4">üéØ M√≥dulo 7: Elegibilidad Empresarial</h3><p class="text-gray-600 mb-6">¬øIncluir cl√°usula? Nivel restricci√≥n, excepci√≥n educativa.</p><p class="text-sm text-gray-500">Demo: M√≥dulo simplificado. Versi√≥n completa incluir√≠a 2-3 preguntas detalladas.</p></div>'
};
MODULOS_DATA.m8 = {
    id: 'm8', titulo: 'Confirmaciones Operativas', icono: '‚öôÔ∏è', badge: 'DESEABLE', tipo: 'preguntas',
    html: '<div class="text-center p-8"><h3 class="text-2xl mb-4">‚öôÔ∏è M√≥dulo 8: Confirmaciones Operativas</h3><p class="text-gray-600 mb-6">22 preguntas r√°pidas: menores, equipos, pagos, privacidad, legal.</p><p class="text-sm text-gray-500">Demo: M√≥dulo simplificado. Versi√≥n completa incluir√≠a 10+ preguntas r√°pidas.</p></div>'
};

// === ESTADO ===
let estadoFormulario = {
    modulo_actual: null,
    respuestas: {},
    modulos_completados: [],
    tiempo_inicio: null
};

// === INICIALIZACI√ìN ===
document.addEventListener('DOMContentLoaded', function() {
    cargarEstadoGuardado();
    mostrarDashboard();
    iniciarAutoguardado();
    actualizarProgreso();
});

function mostrarDashboard() {
    document.getElementById('modulos-container').innerHTML = `
        <section class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <div class="text-center mb-8">
                <div class="inline-block bg-blue-100 rounded-full p-4 mb-4">
                    <span class="text-4xl">üéØ</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-900 mb-2">¬°Bienvenido, Felipe! üëã</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">Este formulario tiene 3 objetivos:</p>
            </div>
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="text-center p-6 bg-blue-50 rounded-lg">
                    <div class="text-3xl mb-2">‚úÖ</div>
                    <h3 class="font-semibold mb-2">Validar Entendimiento</h3>
                    <p class="text-sm text-gray-600">Confirmar modelo de negocio</p>
                </div>
                <div class="text-center p-6 bg-yellow-50 rounded-lg">
                    <div class="text-3xl mb-2">üîç</div>
                    <h3 class="font-semibold mb-2">Mostrar Problemas</h3>
                    <p class="text-sm text-gray-600">Ver qu√© est√° mal en T&C actuales</p>
                </div>
                <div class="text-center p-6 bg-green-50 rounded-lg">
                    <div class="text-3xl mb-2">‚öñÔ∏è</div>
                    <h3 class="font-semibold mb-2">Obtener Decisiones</h3>
                    <p class="text-sm text-gray-600">Recopilar respuestas para redacci√≥n</p>
                </div>
            </div>
            <div class="bg-gray-50 rounded-lg p-6 mb-6">
                <h3 class="font-semibold mb-3">‚è±Ô∏è Flujo Recomendado:</h3>
                <ol class="space-y-2 text-sm text-gray-700">
                    <li>1Ô∏è‚É£ Valida entendimiento (M0 - 2 min)</li>
                    <li>2Ô∏è‚É£ Lee qu√© encontramos (M1 - 5 min)</li>
                    <li>3Ô∏è‚É£ Responde decisiones cr√≠ticas (M2-M4 - 20 min)</li>
                    <li>4Ô∏è‚É£ Completa importantes (M5-M7 - 10 min)</li>
                    <li>5Ô∏è‚É£ Confirmaciones deseables (M8 - 15 min)</li>
                    <li>6Ô∏è‚É£ Revisa evaluaci√≥n final (M9 - lectura)</li>
                </ol>
            </div>
            <div class="text-center">
                <button onclick="navegarModulo('m0')" class="px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 transition transform hover:scale-105">
                    üöÄ Empezar Ahora
                </button>
                <p class="text-sm text-gray-500 mt-3">Tiempo total: 47 minutos | Auto-guardado cada 30s</p>
            </div>
        </section>
    `;
}

function navegarModulo(moduloId) {
    estadoFormulario.modulo_actual = moduloId;
    const modulo = MODULOS_DATA[moduloId];
    
    if (!modulo) {
        mostrarDashboard();
        return;
    }
    
    const container = document.getElementById('modulos-container');
    const badgeColor = modulo.badge === 'GATEWAY' ? 'bg-yellow-600' : 
                        modulo.badge === 'CR√çTICO' ? 'bg-red-600' : 
                        modulo.badge === 'IMPORTANTE' ? 'bg-yellow-600' : 
                        modulo.badge === 'DESEABLE' ? 'bg-green-600' : 'bg-purple-600';
    
    container.innerHTML = `
        <section class="bg-white rounded-lg shadow-lg p-8 mb-6 fade-in">
            <div class="border-b pb-4 mb-6">
                <div class="flex items-start justify-between mb-2">
                    <div>
                        <div class="inline-block px-3 py-1 ${badgeColor} text-white text-xs font-semibold rounded mb-2">${modulo.badge}</div>
                        <h2 class="text-3xl font-bold text-gray-900">${modulo.icono} ${modulo.titulo}</h2>
                    </div>
                </div>
            </div>
            <div>${modulo.html}</div>
            <div class="flex justify-between mt-8 pt-6 border-t">
                <button onclick="moduloAnterior()" class="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition">‚Üê Anterior</button>
                <button onclick="completarModulo('${moduloId}')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold">
                    ${moduloId === 'm9' ? 'üéâ Finalizar' : 'Continuar ‚Üí'}
                </button>
            </div>
        </section>
    `;
    
    actualizarNavegacion();
    cargarRespuestasPrevias(moduloId);
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function actualizarNavegacion() {
    Object.keys(MODULOS_DATA).forEach(id => {
        const btn = document.getElementById(`nav-${id}`);
        if (btn) {
            btn.classList.remove('bg-blue-100', 'border-l-4', 'border-blue-600', 'font-semibold');
            if (id === estadoFormulario.modulo_actual) {
                btn.classList.add('bg-blue-100', 'border-l-4', 'border-blue-600', 'font-semibold');
            }
        }
    });
}

function handleRespuesta(preguntaId, valor) {
    estadoFormulario.respuestas[preguntaId] = valor;
    
    // L√≥gica condicional M0
    if (preguntaId === 'm0_p1' && valor === 'no') {
        document.getElementById('cond_m0_p1').innerHTML = `
            <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded fade-in">
                <label class="block text-sm font-medium mb-2">üìù CORRECCI√ìN: Explica el modelo correcto:</label>
                <textarea id="m0_p1_correccion" rows="3" class="w-full p-3 border-2 rounded-lg" 
                          placeholder="Describe el modelo real..." 
                          onchange="handleRespuesta('m0_p1_correccion', this.value)"></textarea>
            </div>
        `;
    } else if (preguntaId === 'm0_p1' && valor === 'si') {
        document.getElementById('cond_m0_p1').innerHTML = '';
    }
    
    if (preguntaId === 'm0_p2' && valor === 'no') {
        document.getElementById('cond_m0_p2').innerHTML = `
            <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded fade-in">
                <label class="block text-sm font-medium mb-2">¬øQu√© % estimas sin intenci√≥n empresarial?</label>
                <select onchange="handleRespuesta('m0_p2_pct', this.value)" class="w-full p-3 border-2 rounded-lg">
                    <option value="">Selecciona...</option>
                    <option value="<5%"><5%</option>
                    <option value="5-15%">5-15%</option>
                    <option value="15-30%">15-30%</option>
                    <option value=">30%">>30%</option>
                </select>
            </div>
        `;
    } else if (preguntaId === 'm0_p2' && valor === 'si') {
        document.getElementById('cond_m0_p2').innerHTML = '';
    }
    
    // L√≥gica condicional M2 - Investor + Comisi√≥n
    if (preguntaId === 'm2_claim3_comision' && valor === 'si') {
        const verif = estadoFormulario.respuestas['m2_claim3_verif'] || '';
        let riesgo = '';
        if (verif === 'no') riesgo = 'üî¥ RIESGO MUY ALTO';
        else if (verif === 'curamos') riesgo = 'üü° RIESGO MEDIO';
        else if (verif === 'verificamos') riesgo = 'üî¥ RIESGO ALTO';
        
        document.getElementById('cond_m2_c3').innerHTML = `
            <div class="p-4 bg-red-50 border-l-4 border-red-600 rounded fade-in">
                <div class="flex items-start">
                    <div class="text-2xl mr-3">‚ö†Ô∏è</div>
                    <div>
                        <h4 class="font-bold text-red-900 mb-2">ALERTA CR√çTICA: Posible Regulaci√≥n SFC</h4>
                        <div class="text-red-800 text-sm mb-3">
                            Cobrar comisi√≥n por conectar startups-inversores puede constituir intermediaci√≥n financiera regulada.<br><br>
                            <strong>Tu configuraci√≥n: ${riesgo}</strong>
                        </div>
                        <button onclick="mostrarAlerta({tipo:'error',titulo:'Consulta SFC Requerida',mensaje:'Recomendamos consultar abogado especializado antes de lanzar con comisi√≥n.'})" 
                                class="px-3 py-1 text-sm rounded bg-red-600 text-white">
                            M√°s info
                        </button>
                    </div>
                </div>
            </div>
        `;
    } else if (preguntaId === 'm2_claim3_comision' && valor === 'no') {
        document.getElementById('cond_m2_c3').innerHTML = '';
    }
    
    guardarProgreso();
}

function completarModulo(moduloId) {
    // Validaci√≥n M0
    if (moduloId === 'm0') {
        const p1 = estadoFormulario.respuestas['m0_p1'];
        const p2 = estadoFormulario.respuestas['m0_p2'];
        const p3 = estadoFormulario.respuestas['m0_p3'];
        
        if (p1 === 'no' || p2 === 'no' || p3 === 'no') {
            mostrarAlerta({
                tipo: 'warning',
                titulo: '‚ö†Ô∏è PAUSAR - Desalineaci√≥n Detectada',
                mensaje: 'Detectamos desalineaci√≥n en entendimiento. Recomendamos llamada de 15 min para alinear antes de continuar.'
            });
            return;
        }
    }
    
    if (!estadoFormulario.modulos_completados.includes(moduloId)) {
        estadoFormulario.modulos_completados.push(moduloId);
    }
    
    const siguiente = `m${parseInt(moduloId.slice(1)) + 1}`;
    if (MODULOS_DATA[siguiente]) {
        navegarModulo(siguiente);
    } else {
        mostrarAlerta({
            tipo: 'success',
            titulo: 'üéâ ¬°Completado!',
            mensaje: 'Has terminado todos los m√≥dulos. Descarga tu reporte en PDF.'
        });
    }
    
    actualizarProgreso();
    guardarProgreso();
}

function moduloAnterior() {
    const actual = estadoFormulario.modulo_actual;
    if (!actual) return mostrarDashboard();
    
    const num = parseInt(actual.slice(1));
    if (num > 0) {
        navegarModulo(`m${num - 1}`);
    } else {
        mostrarDashboard();
    }
}

function toggleCollapsible(id) {
    const elem = document.getElementById(id);
    const icon = document.getElementById(`icon_${id}`);
    if (elem.classList.contains('expanded')) {
        elem.classList.remove('expanded');
        if (icon) icon.textContent = '‚ñº';
    } else {
        elem.classList.add('expanded');
        if (icon) icon.textContent = '‚ñ≤';
    }
}

function actualizarProgreso() {
    const total = Object.keys(MODULOS_DATA).length;
    const completados = estadoFormulario.modulos_completados.length;
    const pct = Math.round((completados / total) * 100);
    
    document.getElementById('progress-bar').style.width = `${pct}%`;
    document.getElementById('progress-text').textContent = `${pct}% (${completados}/${total})`;
    document.getElementById('completados').textContent = completados;
    document.getElementById('pendientes').textContent = total - completados;
}

function mostrarAlerta(config) {
    const modal = document.getElementById('alert-modal');
    const iconos = { 'error': 'üî¥', 'warning': '‚ö†Ô∏è', 'success': '‚úÖ', 'info': '‚ÑπÔ∏è' };
    
    document.getElementById('alert-icon').textContent = iconos[config.tipo] || '‚ÑπÔ∏è';
    document.getElementById('alert-title').textContent = config.titulo;
    document.getElementById('alert-message').innerHTML = config.mensaje;
    document.getElementById('alert-actions').innerHTML = `
        <button onclick="cerrarModal()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cerrar</button>
    `;
    
    modal.classList.remove('hidden');
}

function cerrarModal() {
    document.getElementById('alert-modal').classList.add('hidden');
}

function guardarProgreso() {
    localStorage.setItem('niilo_formulario_v3', JSON.stringify(estadoFormulario));
}

function cargarEstadoGuardado() {
    const guardado = localStorage.getItem('niilo_formulario_v3');
    if (guardado) {
        try {
            estadoFormulario = JSON.parse(guardado);
        } catch (e) {}
    }
}

function cargarRespuestasPrevias(moduloId) {
    Object.entries(estadoFormulario.respuestas).forEach(([id, valor]) => {
        const input = document.querySelector(`[name="${id}"][value="${valor}"]`) || document.getElementById(id);
        if (input) {
            if (input.type === 'radio') input.checked = true;
            else input.value = valor;
        }
    });
}

function iniciarAutoguardado() {
    setInterval(guardarProgreso, 30000);
}

function exportarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    let y = 20;
    doc.setFontSize(20);
    doc.text('Niilo - Reporte Entendimiento Operativo', 20, y);
    y += 15;
    
    doc.setFontSize(12);
    doc.text(`Fecha: ${new Date().toLocaleDateString('es-CO')}`, 20, y);
    y += 10;
    
    const completados = estadoFormulario.modulos_completados.length;
    const total = Object.keys(MODULOS_DATA).length;
    doc.text(`Progreso: ${completados}/${total} m√≥dulos (${Math.round(completados/total*100)}%)`, 20, y);
    y += 15;
    
    doc.setFontSize(14);
    doc.text('Respuestas:', 20, y);
    y += 10;
    
    doc.setFontSize(10);
    Object.entries(estadoFormulario.respuestas).forEach(([pregunta, respuesta]) => {
        if (y > 270) {
            doc.addPage();
            y = 20;
        }
        const texto = `${pregunta}: ${respuesta}`;
        doc.text(texto.substring(0, 80), 20, y);
        y += 7;
    });
    
    doc.save(`niilo_reporte_${Date.now()}.pdf`);
    mostrarAlerta({ tipo: 'success', titulo: '‚úÖ PDF Generado', mensaje: 'El reporte ha sido descargado exitosamente.' });
}
    </script>
</body>
</html>
